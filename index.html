<!doctype html>
<html ng-app="writeArticleApp">
  <head>
  	<title>Editor - Mạng Văn Học</title>
    <meta charset="UTF-8">
    <script src="lib/angular.min.js"></script>
    <script src="lib/snap.min.js"></script>
    <script src="lib/angular-snap.js"></script>
    <script src="lib/angular-touch.js"></script>
	<script src="lib/medium-editor/js/medium-editor.js"></script>
	<script src="lib/angular-medium-editor.min.js"></script>
	<script>
		'use strict';
		angular.module('configContenteditable', []).
		  directive('contenteditable', function () {
		      return {
		          restrict: 'A', // only activate on element attribute
		          require: '?ngModel', // get a hold of NgModelController
		          link: function (scope, element, attrs, ngModel) {
		              if (!ngModel) return; // do nothing if no ng-model

		              // Specify how UI should be updated
		              ngModel.$render = function () {
		                  element.html(ngModel.$viewValue || '');
		              };

		              // Listen for change events to enable binding
		              element.on('blur keyup change', function () {
		                  scope.$apply(readViewText);
		              });

		              // No need to initialize, AngularJS will initialize the text based on ng-model attribute

		              // Write data to the model
		              function readViewText() {
		                  var html = element.html();
		                  // When we clear the content editable the browser leaves a <br> behind
		                  // If strip-br attribute is provided then we strip this out
		                  if (attrs.stripBr && html == '<br>') {
		                      html = '';
		                  }
		                  ngModel.$setViewValue(html);
		              }
		          }
		      };
		  });

		angular.module('writeArticleApp', ['snap','angular-medium-editor','configContenteditable'])
		.config(function(snapRemoteProvider) {
			snapRemoteProvider.globalOptions = {
			      disable: 'right',
			      touchToDrag: false
			    }
		})
		.controller('mainCtrl', function($scope, snapRemote, $http){
			snapRemote.getSnapper().then(function(snapper){
				snapper.on('open',function(){
					$scope.disableBoxControl = true;
					$scope.$apply();
				});

				snapper.on('close', function(){
					$scope.disableBoxControl = false;
					$scope.$apply();
				});
			});

			$scope.publishArticle = function(){
		 		console.log('click', $scope.content);
		 		var data = {
		 			'title' : $scope.title,
		 			'subtitle' : $scope.subtitle,
		 			'content' : $scope.content
		 		};
		 		console.log(data);

		 		$http.post('http://localhost:3000/article/save', data).
				    success(function(data, status, headers, config) {
				      console.log('success', data);
				    }).
				    error(function(data, status, headers, config) {
				      console.log('error', data);
				    });
		 		}
		})
		.controller('writeArticleController', ['$scope', function($scope) {
		
		 //$scope.content = "<h1>NẾU KHÔNG PHẢI LÀ ANH</h1><div id='page1' class='page'><h2>VỢ THUÊ</h2><p>Nhi run rẩy chạy dọc theo hành lang trắng xóa của bệnh viện đa khoa đặc mùi thuốc khử trùng. Tin xấu từ người dì họ dưới quê nhà luôn ám ảnh trong đầu cô suốt quãng đường từ Sài Gòn về. Thế nên mặc dù cô luôn tự trấn an rằng em trai mình sẽ không gặp vấn đề gì nghiêm trọng, nhưng linh tính mách bảo khiến những bước chân của Nhi không thể nào vững chãi nữa.</p><p>\"Bác sỹ, em trai của tôi sao rồi ạ?\"</p><p>Bác sỹ vỗ vỗ vai Nhi trấn tĩnh và an ủi khi nhìn thấy cô đứng sững sờ trong làn nước mắt. Vài chục triệu à? Hai năm qua học ở Sài Gòn, đến hai triệu đồng cô còn chưa có. Tiền nhà trọ, tiền học phí, lại thêm việc mỗi tháng cô đều phải gửi tiền về quê cho người dì họ chăm sóc đứa em trai khờ khạo, số tiền làm thêm và dành dụm cô cũng chỉ xoay sở được những phần chi phí sinh hoạt khác.</p></div><div id='page2' class='page'><h2>\"NGỌC TRONG ĐÁ\"</h2><p>Ngày thứ nhất làm vợ.</p><p>Cũng không quá khó khăn hay tồi tệ so với những gì Gia Nhi đã từng trải qua trong thời gian cô trưởng thành không cha không mẹ. Nhớ lại buổi tối hôm qua, Cao Nguyên nhìn thấy dáng vóc ngồi co ro trên đầu giường của cô, anh không nói lời nào, chỉ tặng cho cô một nụ cười miệt thị rồi lẳng lặng ôm cả gối và chăn định chuyển sang phòng khác. Nhưng Gia Nhi đã lên tiếng trước.</p><p>\"Nếu anh cho phép, tôi có thể qua phòng của bé Dương…\"</p><p>\"Bé Dương đã có má Lam. Cô cứ ở đây, nhà tôi nhiều phòng, cô không cần lo.\"</p><p>\"Thật sự thì tôi không quen nằm trên một chiếc giường rộng rãi như thế này. Vả lại, anh đã thuê tôi là mẹ bé Dương, tôi cũng muốn làm tròn trách nhiệm. Tôi sẽ cùng má Lam chăm sóc con anh.\"</p><p>Tối đó, Gia Nhi trằn trọc suốt đêm. Cô không ngủ được vì lo cho những ngày sắp đến, không biết bản thân mình sẽ đi đến bước đường nào nữa. Cô sực nhớ đến Huy, suy nghĩ đến ngày vào trường gặp lại anh, cô phải đối mặt như thế nào. Bất chợt có giọt nước mắt nóng hổi lăn trên má cô.</p><p>Buổi sáng thứ bảy, trời trong xanh, không khí trong lành khiến tâm trạng mọi người cũng thoải mái. Má Lam hì hục chuẩn bị hai phần bò bít tết thật nóng hổi cho bữa điểm tâm. Trong khi đó, Gia Nhi vẫn nằm cuộn tròn trong chăn cho đến khi chiếc điện thoại rung bần bật, nhìn con số tám hiện lên trên màn hình, cô mới bật dậy chui ngay khỏi chăn, trong đầu suy nghĩ lần này chắc chắn sẽ bị người “chồng” kia hằn học thôi. Trước khi ra khỏi phòng, Gia Nhi vẫn không quên liếc nhìn Nguyên Dương, mỉm cười.</p></div>";
		
		}]);
	</script>
	<link rel="stylesheet" type="text/css" href="lib/medium-editor/css/medium-editor.css">
	<link rel="stylesheet" type="text/css" href="lib/medium-editor/css//themes/default.css">
	<link rel="stylesheet" type="text/css" href="css/article.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/sider.css">
    <link rel="stylesheet" type="text/css" href="css/lib/snap.css">
    <link rel="stylesheet" type="text/css" href="css/lib/angular-snap.css">
  </head>
  <body ng-controller="mainCtrl">
  	<div class="fixed">
  		<span ng-class="{'box_control_disable':disableBoxControl}" class="box_control" snap-toggle="left"></span>
  	</div>
  	<snap-drawer>
  		<div id="sider" class="sider">
  			<ul class="sider_list">
  				<li class="sider_list_item"><a class="sider_list_item_btn" href="#">Home</a></li>
  				<li class="sider_list_item"><a class="sider_list_item_btn" href="#">New Story</a></li>
  				<li class="sider_list_item"><a class="sider_list_item_btn" href="#">Draft</a></li>
  				<li class="sider_list_item"><a class="sider_list_item_btn" href="#">Stats</a></li>
  				<li class="sider_list_item"><a class="sider_list_item_btn" href="#">Collections</a></li>
  			</ul>
  		</div>
  	</snap-drawer>
  	<snap-content>
	  	<div id="wrapper">
	  		<div id="menu" class="top_bar">
				<div class="top_bar_block align_left">
					
				</div>
				<div class="top_bar_block align_right">
					<button class="btn btn-delete btn-danger" title="Delete">Delete</button>
					<button class="btn btn-history btn-normal" title="History">History</button>
					<button class="btn btn-share-draft btn-normal" title="Share Draft">Share Draft</button>
					<button class="btn btn-publish btn-primary" ng-click="publishArticle()" title="Publish">Publish</button>
				</div>
	  		</div>
			<div id="container">
			    <div>
					<div>
						<form name="write_article" id="write_article">
							<h1 id="article_title" contenteditable="true" ng-model="title" placeholder="Title" autofocus></h1>
							<h2 id="article_subtitle" contenteditable="true" ng-model="subtitle" placeholder="SubTitle" /></h2>
				      		<div id="article_content" medium-editor ng-model="content" spellcheck="false" data-placeholder="Write your story"></div>
					  	</form>
				  	</div>
				</div>
			</div>
  	</div>
  	</snap-content>
  	<script type="text/javascript">
  		document.getElementById('article_title').focus();
  	</script>
  </body>
</html>